<form (submit)="$event.preventDefault()" [formGroup]="form" class="card home">
  <mat-accordion [multi]="false">
    <!-- 1. Grösse und Gewicht -->
    <mat-expansion-panel
      (opened)="goToStep(1)"
      [expanded]="currentStep() === 1"
      hideToggle
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <h2 class="h2">
            1. Grösse und Gewicht
          </h2>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <p class="p home__subtitle">
        Welches sind Ihre Körpermasse?
      </p>
      <div class="grid-2">
        <div class="field">
          <div
            (click)="setActive('heightCm')"
            [class.has-value]="hasValue(form.controls.heightCm)"
            [class.is-active]="isActive('heightCm') || hasValue(form.controls.heightCm)"
            [class.is-invalid]="isInvalid('heightCm')"
            class="box box--unit"
          >
            <input
              (focus)="setActive('heightCm')"
              formControlName="heightCm"
              inputmode="numeric"
              max="350"
              min="0"
              placeholder="Grösse"
              type="number"
            />
            <span
              [style.color]="hasValue(form.controls.heightCm) ? '#0E0E0E' : null"
              class="unit"
            >
        (cm)
      </span>
          </div>

          @if (isInvalid('heightCm')) {
            <p class="error">Grösse ist (0–350 cm).</p>
          }
        </div>

        <div class="field">
          <div
            (click)="setActive('weightKg')"
            [class.has-value]="hasValue(form.controls.weightKg)"
            [class.is-active]="isActive('weightKg') || hasValue(form.controls.weightKg)"
            [class.is-invalid]="isInvalid('weightKg')"
            class="box box--unit"
          >
            <input
              (focus)="setActive('weightKg')"
              formControlName="weightKg"
              inputmode="numeric"
              max="600"
              min="0"
              placeholder="Gewicht"
              type="number"
            />
            <span
              [style.color]="hasValue(form.controls.weightKg) ? '#0E0E0E' : null"
              class="unit"
            >
          (kg)
        </span>
          </div>

          @if (isInvalid('weightKg')) {
            <p class="error">Gewicht ist (0–600 kg).</p>
          }
        </div>
      </div>

      <p class="p home__subtitle" style="margin-top: 10px">
        - Falls Sie schwanger sind, geben Sie bitte Ihr Gewicht zu Beginn der Schwangerschaft an.
      </p>

      <div class="nav">
        <button (click)="onNext()" class="btn-next" type="button">Next</button>
      </div>
    </mat-expansion-panel>


    <!-- 2. Medikamente oder Hilfsmittel -->
    @if (maxStepReached() >= 2) {
      <mat-expansion-panel
        (opened)="goToStep(2)"
        [expanded]="currentStep() === 2"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">2. Medikamente oder Hilfsmittel</h2>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div
          (click)="setActive('medication')"
          [class.is-active]="isActive('medication') || hasValue(form.controls.medication)"
          [class.is-invalid]="isInvalid('medication')"
          class="seg"
        >
          <button
            (click)="$event.stopPropagation(); setMedication(false)"
            [class.is-selected]="form.controls.medication.value === false"
            class="seg__btn"
            type="button"
          >
            Nein
          </button>

          <button
            (click)="$event.stopPropagation(); setMedication(true)"
            [class.is-selected]="form.controls.medication.value === true"
            class="seg__btn"
            type="button"
          >
            Ja
          </button>
        </div>

        @if (isInvalid('medication')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (showMedicationDetails()) {
          <p class="home__subtitle">
            Nehmen Sie momentan Medikamente ein oder haben Sie in den letzten 2 Jahren regelmässig oder wiederholt
            welche eingenommen (mit Ausnahme von Verhütungsmitteln) oder haben Sie eine medizinische Verordnung für
            Hilfsmittel oder Geräte erhalten (mit Ausnahme von Brillen und Kontaktlinsen)?
          </p>

          <div class="grid-2 med-head">
            <p class="home__subtitle med-head__text">Wenn ja, welche?</p>
            <p class="home__subtitle med-head__text">Warum?</p>
          </div>

          <div class="grid-2">
            <div class="field">
              <div
                (click)="setActive('medName')"
                [class.is-active]="isActive('medName') || hasText(form.controls.medName)"
                [class.is-invalid]="isInvalid('medName')"
                class="box"
              >
                <input
                  (focus)="setActive('medName')"
                  formControlName="medName"
                  placeholder="Welche?"
                  type="text"
                />
              </div>
              @if (isInvalid('medName')) {
                <p class="error">Bitte ausfüllen.</p>
              }
            </div>

            <div class="field">
              <div
                (click)="setActive('medReason')"
                [class.is-active]="isActive('medReason') || hasText(form.controls.medReason)"
                [class.is-invalid]="isInvalid('medReason')"
                class="box"
              >
                <input
                  (focus)="setActive('medReason')"
                  formControlName="medReason"
                  placeholder="Warum?"
                  type="text"
                />
              </div>
              @if (isInvalid('medReason')) {
                <p class="error">Bitte ausfüllen.</p>
              }
            </div>
          </div>

          <div class="illness" formArrayName="illnessesMed">
            @for (g of illnessesMed.controls; track g; let i = $index) {
              <div [formGroupName]="i" class="illness__card" (click)="$event.stopPropagation()">
                <div class="illness__head">
                  <div class="illness__title">{{ i + 1 }}) Krankheit erfassen</div>

                  @if (illnessesMed.length > 1) {
                    <button
                      type="button"
                      class="illness__remove"
                      (click)="$event.stopPropagation(); removeMedIllnessByRef(g)"
                    >
                      - Entfernen
                    </button>
                  }
                </div>

                <p class="illness__hint">
                  Krankheit, Leiden, Unfall, Behandlungsgrund, betroffene Stelle am Körper (links, rechts)
                </p>

                <div
                  (click)="setActive(medActiveKey(i,'desc'))"
                  [class.is-active]="isMedActive(i,'desc') || hasText(illnessCtrl(illnessesMed, i,'desc'))"
                  [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesMed, i,'desc'))"
                  class="box box--textarea"
                >
                <textarea
                  (focus)="setActive(medActiveKey(i,'desc'))"
                  (input)="autoResize($event)"
                  formControlName="desc"
                  placeholder="Hier eingeben..."
                ></textarea>

                  <span aria-hidden="true" class="icon-pencil"></span>
                </div>

                @if (isInvalidCtrl(illnessCtrl(illnessesMed, i, 'desc'))) {
                  <p class="error">Bitte ausfüllen.</p>
                }

                <div class="grid-2 dates">
                  <div
                    [class.has-error]="isInvalidCtrl(illnessCtrl(illnessesMed, i,'startDate'))"
                    class="field"
                  >
                    <label class="label">Begindatum</label>

                    <div
                      (click)="setActive(medActiveKey(i,'start'))"
                      [class.is-active]="isMedActive(i,'start') || hasText(illnessCtrl(illnessesMed, i,'startDate'))"
                      [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesMed, i,'startDate'))"
                      class="box"
                    >
                      <input
                        (focus)="setActive(medActiveKey(i,'start'))"
                        formControlName="startDate"
                        type="date"
                      />
                      <img alt="" aria-hidden="true" class="calendar-icon" src="/Icon.jpg"/>
                    </div>

                    @if (isInvalidCtrl(illnessCtrl(illnessesMed, i, 'startDate'))) {
                      <p class="error">Bitte Datum wählen.</p>
                    }
                  </div>

                  <div
                    [class.has-error]="isInvalidCtrl(illnessCtrl(illnessesMed, i,'endDate'))"
                    class="field"
                  >
                    <label class="label">Enddatum</label>

                    <div
                      (click)="setActive(medActiveKey(i,'end'))"
                      [class.is-active]="isMedActive(i,'end') || hasText(illnessCtrl(illnessesMed, i,'endDate'))"
                      [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesMed, i,'endDate'))"
                      class="box"
                    >
                      <input
                        (focus)="setActive(medActiveKey(i,'end'))"
                        formControlName="endDate"
                        type="date"
                      />
                      <img alt="" aria-hidden="true" class="calendar-icon" src="/Icon.jpg"/>
                    </div>

                    @if (isInvalidCtrl(illnessCtrl(illnessesMed, i, 'endDate'))) {
                      <p class="error">Bitte Datum wählen.</p>
                    }
                  </div>
                </div>

                <div class="field">
                  <label class="label">Operiert?</label>
                  <div
                    (click)="setActive(medActiveKey(i,'operated'))"
                    [class.is-active]="isMedActive(i,'operated') || hasValue(illnessCtrl(illnessesMed, i,'operated'))"
                    [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesMed, i,'operated'))"
                    class="seg"
                  >
                    <button
                      (click)="$event.stopPropagation(); setMedBool(i,'operated',false)"
                      [class.is-selected]="illnessCtrl(illnessesMed, i,'operated').value === false"
                      class="seg__btn"
                      type="button"
                    >
                      Nein
                    </button>
                    <button
                      (click)="$event.stopPropagation(); setMedBool(i,'operated',true)"
                      [class.is-selected]="illnessCtrl(illnessesMed, i,'operated').value === true"
                      class="seg__btn"
                      type="button"
                    >
                      Ja
                    </button>
                  </div>

                  @if (isInvalidCtrl(illnessCtrl(illnessesMed, i, 'operated'))) {
                    <p class="error">Bitte wählen.</p>
                  }
                </div>

                <div class="field">
                  <label class="label">Behandlung beendet, genesen ohne Folgen</label>
                  <div
                    (click)="setActive(medActiveKey(i,'treatmentDone'))"
                    [class.is-active]="isMedActive(i,'treatmentDone') || hasValue(illnessCtrl(illnessesMed, i,'treatmentDone'))"
                    [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesMed, i,'treatmentDone'))"
                    class="seg"
                  >
                    <button
                      (click)="$event.stopPropagation(); setMedBool(i,'treatmentDone',false)"
                      [class.is-selected]="illnessCtrl(illnessesMed, i,'treatmentDone').value === false"
                      class="seg__btn"
                      type="button"
                    >
                      Nein
                    </button>
                    <button
                      (click)="$event.stopPropagation(); setMedBool(i,'treatmentDone',true)"
                      [class.is-selected]="illnessCtrl(illnessesMed, i,'treatmentDone').value === true"
                      class="seg__btn"
                      type="button"
                    >
                      Ja
                    </button>
                  </div>

                  @if (isInvalidCtrl(illnessCtrl(illnessesMed, i, 'treatmentDone'))) {
                    <p class="error">Bitte wählen.</p>
                  }
                </div>

                <div class="provider">
                  <p class="provider__title">
                    Name und Adresse des Arztes, Spitals oder anderen Leistungserbringers
                  </p>

                  <div class="provider__grid provider__grid--name">
                    <div class="field">
                      <div
                        (click)="setActive(medActiveKey(i,'docFirstName'))"
                        [class.is-active]="isMedActive(i,'docFirstName') || hasText(illnessCtrl(illnessesMed, i,'docFirstName'))"
                        [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesMed, i,'docFirstName'))"
                        class="box provider__box"
                      >
                        <input
                          (focus)="setActive(medActiveKey(i,'docFirstName'))"
                          formControlName="docFirstName"
                          placeholder="Vorname"
                          type="text"
                        />
                      </div>
                      @if (isInvalidCtrl(illnessCtrl(illnessesMed, i, 'docFirstName'))) {
                        <p class="error">Bitte ausfüllen.</p>
                      }
                    </div>

                    <div class="field">
                      <div
                        (click)="setActive(medActiveKey(i,'docLastName'))"
                        [class.is-active]="isMedActive(i,'docLastName') || hasText(illnessCtrl(illnessesMed, i,'docLastName'))"
                        [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesMed, i,'docLastName'))"
                        class="box provider__box"
                      >
                        <input
                          (focus)="setActive(medActiveKey(i,'docLastName'))"
                          formControlName="docLastName"
                          placeholder="Nachname"
                          type="text"
                        />
                      </div>
                      @if (isInvalidCtrl(illnessCtrl(illnessesMed, i, 'docLastName'))) {
                        <p class="error">Bitte ausfüllen.</p>
                      }
                    </div>
                  </div>

                  <div class="provider__grid provider__grid--street">
                    <div class="field">
                      <div
                        (click)="setActive(medActiveKey(i,'docStreet'))"
                        [class.is-active]="isMedActive(i,'docStreet') || hasText(illnessCtrl(illnessesMed, i,'docStreet'))"
                        [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesMed, i,'docStreet'))"
                        class="box provider__box"
                      >
                        <input
                          (focus)="setActive(medActiveKey(i,'docStreet'))"
                          formControlName="docStreet"
                          placeholder="Strasse"
                          type="text"
                        />
                      </div>
                      @if (isInvalidCtrl(illnessCtrl(illnessesMed, i, 'docStreet'))) {
                        <p class="error">Bitte ausfüllen.</p>
                      }
                    </div>

                    <div class="field">
                      <div
                        (click)="setActive(medActiveKey(i,'docNr'))"
                        [class.is-active]="isMedActive(i,'docNr') || hasText(illnessCtrl(illnessesMed, i,'docNr'))"
                        [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesMed, i,'docNr'))"
                        class="box provider__box"
                      >
                        <input
                          (focus)="setActive(medActiveKey(i,'docNr'))"
                          formControlName="docNr"
                          placeholder="Nr."
                          type="text"
                        />
                      </div>
                      @if (isInvalidCtrl(illnessCtrl(illnessesMed, i, 'docNr'))) {
                        <p class="error">Bitte ausfüllen.</p>
                      }
                    </div>
                  </div>

                  <div class="provider__grid provider__grid--zip">
                    <div class="field">
                      <div
                        (click)="setActive(medActiveKey(i,'docZipCity'))"
                        [class.is-active]="isMedActive(i,'docZipCity') || hasText(illnessCtrl(illnessesMed, i,'docZipCity'))"
                        [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesMed, i,'docZipCity'))"
                        class="box provider__box"
                      >
                        <input
                          (focus)="setActive(medActiveKey(i,'docZipCity'))"
                          formControlName="docZipCity"
                          placeholder="PLZ, Ort"
                          type="text"
                        />
                      </div>
                      @if (isInvalidCtrl(illnessCtrl(illnessesMed, i, 'docZipCity'))) {
                        <p class="error">Bitte ausfüllen.</p>
                      }
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>

          <button
            (click)="addMedIllness()"
            [attr.aria-disabled]="!canAddMedIllness()"
            [class.is-disabled]="!canAddMedIllness()"
            class="btn-add btn-add--bottom"
            type="button"
          >
            + Krankheit erfassen
          </button>
        }

        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 3. Krankheiten oder Beschwerden -->
    @if (maxStepReached() >= 3) {
      <mat-expansion-panel
        (opened)="goToStep(3)"
        [expanded]="currentStep() === 3"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              3. Krankheiten oder Beschwerden
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div
          (click)="setActive('illnessQ')"
          [class.is-active]="isActive('illnessQ') || hasValue(form.controls.illnessQ)"
          [class.is-invalid]="isInvalid('illnessQ')"
          class="seg"
        >
          <button
            (click)="$event.stopPropagation(); setIllnessQ(false)"
            [class.is-selected]="form.controls.illnessQ.value === false"
            class="seg__btn"
            type="button"
          >
            Nein
          </button>

          <button
            (click)="$event.stopPropagation(); setIllnessQ(true)"
            [class.is-selected]="form.controls.illnessQ.value === true"
            class="seg__btn"
            type="button"
          >
            Ja
          </button>
        </div>

        @if (isInvalid('illnessQ')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (showIllnessDetails()) {
          <p class="home__desc">
            Haben Sie in den vergangenen 5 Jahren an Krankheiten oder Beschwerden gelitten oder leiden Sie noch daran
            (ausser saisonale Krankheiten und geheilte Covid-Erkrankung ohne Nebenwirkung oder Langzeitfolgen)?
            Als Krankheiten oder Beschwerden gelten beispielsweise: Diabetes, Wirbelsäulenerkrankungen, Krebs oder
            Tumore, Suchterkrankung (Drogen, Alkohol, Medikamente), HIV (AIDS), Long-Covid, Essstörungen etc.
            Diese Aufzählung ist nicht abschliessend.
          </p>

          <div class="illness" formArrayName="illnessesIll">
            @for (g of illnessesIll.controls; track g; let i = $index) {
              <div [formGroupName]="i" class="illness__card" (click)="$event.stopPropagation()">
                <div class="illness__head">
                  <div class="illness__title">{{ i + 1 }}) Krankheit erfassen</div>

                  @if (illnessesIll.length > 1) {
                    <button
                      type="button"
                      class="illness__remove"
                      (click)="$event.stopPropagation(); removeIllIllnessByRef(g)"
                    >
                      - Entfernen
                    </button>
                  }
                </div>

                <p class="illness__hint">
                  Krankheit, Leiden, Unfall, Behandlungsgrund, betroffene Stelle am Körper (links, rechts)
                </p>

                <div
                  (click)="setActive(illActiveKey(i,'desc'))"
                  [class.is-active]="isIllActive(i,'desc') || hasText(illnessCtrl(illnessesIll, i,'desc'))"
                  [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesIll, i,'desc'))"
                  class="box box--textarea"
                >
              <textarea
                (focus)="setActive(illActiveKey(i,'desc'))"
                (input)="autoResize($event)"
                formControlName="desc"
                placeholder="Hier eingeben..."
              ></textarea>

                  <span aria-hidden="true" class="icon-pencil"></span>
                </div>
                @if (isInvalidCtrl(illnessCtrl(illnessesIll, i, 'desc'))) {
                  <p class="error">Bitte ausfüllen.</p>
                }

                <div class="grid-2 dates">
                  <div
                    [class.has-error]="isInvalidCtrl(illnessCtrl(illnessesIll, i,'startDate'))"
                    class="field"
                  >
                    <label class="label">Begindatum</label>

                    <div
                      (click)="setActive(illActiveKey(i,'start'))"
                      [class.is-active]="isIllActive(i,'start') || hasText(illnessCtrl(illnessesIll, i,'startDate'))"
                      [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesIll, i,'startDate'))"
                      class="box"
                    >
                      <input
                        (focus)="setActive(illActiveKey(i,'start'))"
                        formControlName="startDate"
                        type="date"
                      />
                      <img alt="" aria-hidden="true" class="calendar-icon" src="/Icon.jpg"/>
                    </div>

                    @if (isInvalidCtrl(illnessCtrl(illnessesIll, i, 'startDate'))) {
                      <p class="error">Bitte Datum wählen.</p>
                    }
                  </div>

                  <div
                    [class.has-error]="isInvalidCtrl(illnessCtrl(illnessesIll, i,'endDate'))"
                    class="field"
                  >
                    <label class="label">Enddatum</label>

                    <div
                      (click)="setActive(illActiveKey(i,'end'))"
                      [class.is-active]="isIllActive(i,'end') || hasText(illnessCtrl(illnessesIll, i,'endDate'))"
                      [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesIll, i,'endDate'))"
                      class="box"
                    >
                      <input
                        (focus)="setActive(illActiveKey(i,'end'))"
                        formControlName="endDate"
                        type="date"
                      />
                      <img alt="" aria-hidden="true" class="calendar-icon" src="/Icon.jpg"/>
                    </div>

                    @if (isInvalidCtrl(illnessCtrl(illnessesIll, i, 'endDate'))) {
                      <p class="error">Bitte Datum wählen.</p>
                    }
                  </div>
                </div>

                <div class="field">
                  <label class="label">Operiert?</label>
                  <div
                    (click)="setActive(illActiveKey(i,'operated'))"
                    [class.is-active]="isIllActive(i,'operated') || hasValue(illnessCtrl(illnessesIll, i,'operated'))"
                    [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesIll, i,'operated'))"
                    class="seg"
                  >
                    <button
                      (click)="$event.stopPropagation(); setIllBool(i,'operated',false)"
                      [class.is-selected]="illnessCtrl(illnessesIll, i,'operated').value === false"
                      class="seg__btn"
                      type="button"
                    >
                      Nein
                    </button>
                    <button
                      (click)="$event.stopPropagation(); setIllBool(i,'operated',true)"
                      [class.is-selected]="illnessCtrl(illnessesIll, i,'operated').value === true"
                      class="seg__btn"
                      type="button"
                    >
                      Ja
                    </button>
                  </div>

                  @if (isInvalidCtrl(illnessCtrl(illnessesIll, i, 'operated'))) {
                    <p class="error">Bitte wählen.</p>
                  }
                </div>

                <div class="field">
                  <label class="label">Behandlung beendet, genesen ohne Folgen</label>
                  <div
                    (click)="setActive(illActiveKey(i,'treatmentDone'))"
                    [class.is-active]="isIllActive(i,'treatmentDone') || hasValue(illnessCtrl(illnessesIll, i,'treatmentDone'))"
                    [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesIll, i,'treatmentDone'))"
                    class="seg"
                  >
                    <button
                      (click)="$event.stopPropagation(); setIllBool(i,'treatmentDone',false)"
                      [class.is-selected]="illnessCtrl(illnessesIll, i,'treatmentDone').value === false"
                      class="seg__btn"
                      type="button"
                    >
                      Nein
                    </button>
                    <button
                      (click)="$event.stopPropagation(); setIllBool(i,'treatmentDone',true)"
                      [class.is-selected]="illnessCtrl(illnessesIll, i,'treatmentDone').value === true"
                      class="seg__btn"
                      type="button"
                    >
                      Ja
                    </button>
                  </div>

                  @if (isInvalidCtrl(illnessCtrl(illnessesIll, i, 'treatmentDone'))) {
                    <p class="error">Bitte wählen.</p>
                  }
                </div>

                <div class="provider">
                  <p class="provider__title">
                    Name und Adresse des Arztes, Spitals oder anderen Leistungserbringers
                  </p>

                  <div class="provider__grid provider__grid--name">
                    <div class="field">
                      <div
                        (click)="setActive(illActiveKey(i,'docFirstName'))"
                        [class.is-active]="isIllActive(i,'docFirstName') || hasText(illnessCtrl(illnessesIll, i,'docFirstName'))"
                        [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesIll, i,'docFirstName'))"
                        class="box provider__box"
                      >
                        <input
                          (focus)="setActive(illActiveKey(i,'docFirstName'))"
                          formControlName="docFirstName"
                          placeholder="Vorname"
                          type="text"
                        />
                      </div>
                      @if (isInvalidCtrl(illnessCtrl(illnessesIll, i, 'docFirstName'))) {
                        <p class="error">Bitte ausfüllen.</p>
                      }
                    </div>

                    <div class="field">
                      <div
                        (click)="setActive(illActiveKey(i,'docLastName'))"
                        [class.is-active]="isIllActive(i,'docLastName') || hasText(illnessCtrl(illnessesIll, i,'docLastName'))"
                        [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesIll, i,'docLastName'))"
                        class="box provider__box"
                      >
                        <input
                          (focus)="setActive(illActiveKey(i,'docLastName'))"
                          formControlName="docLastName"
                          placeholder="Nachname"
                          type="text"
                        />
                      </div>
                      @if (isInvalidCtrl(illnessCtrl(illnessesIll, i, 'docLastName'))) {
                        <p class="error">Bitte ausfüllen.</p>
                      }
                    </div>
                  </div>

                  <div class="provider__grid provider__grid--street">
                    <div class="field">
                      <div
                        (click)="setActive(illActiveKey(i,'docStreet'))"
                        [class.is-active]="isIllActive(i,'docStreet') || hasText(illnessCtrl(illnessesIll, i,'docStreet'))"
                        [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesIll, i,'docStreet'))"
                        class="box provider__box"
                      >
                        <input
                          (focus)="setActive(illActiveKey(i,'docStreet'))"
                          formControlName="docStreet"
                          placeholder="Strasse"
                          type="text"
                        />
                      </div>
                      @if (isInvalidCtrl(illnessCtrl(illnessesIll, i, 'docStreet'))) {
                        <p class="error">Bitte ausfüllen.</p>
                      }
                    </div>

                    <div class="field">
                      <div
                        (click)="setActive(illActiveKey(i,'docNr'))"
                        [class.is-active]="isIllActive(i,'docNr') || hasText(illnessCtrl(illnessesIll, i,'docNr'))"
                        [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesIll, i,'docNr'))"
                        class="box provider__box"
                      >
                        <input
                          (focus)="setActive(illActiveKey(i,'docNr'))"
                          formControlName="docNr"
                          placeholder="Nr."
                          type="text"
                        />
                      </div>
                      @if (isInvalidCtrl(illnessCtrl(illnessesIll, i, 'docNr'))) {
                        <p class="error">Bitte ausfüllen.</p>
                      }
                    </div>
                  </div>

                  <div class="provider__grid provider__grid--zip">
                    <div class="field">
                      <div
                        (click)="setActive(illActiveKey(i,'docZipCity'))"
                        [class.is-active]="isIllActive(i,'docZipCity') || hasText(illnessCtrl(illnessesIll, i,'docZipCity'))"
                        [class.is-invalid]="isInvalidCtrl(illnessCtrl(illnessesIll, i,'docZipCity'))"
                        class="box provider__box"
                      >
                        <input
                          (focus)="setActive(illActiveKey(i,'docZipCity'))"
                          formControlName="docZipCity"
                          placeholder="PLZ, Ort"
                          type="text"
                        />
                      </div>
                      @if (isInvalidCtrl(illnessCtrl(illnessesIll, i, 'docZipCity'))) {
                        <p class="error">Bitte ausfüllen.</p>
                      }
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>

          <button
            (click)="addIllIllness()"
            [attr.aria-disabled]="!canAddIllIllness()"
            [class.is-disabled]="!canAddIllIllness()"
            class="btn-add btn-add--bottom"
            type="button"
          >
            + Krankheit erfassen
          </button>
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 4. Behandlungen -->
    @if (maxStepReached() >= 4) {
      <mat-expansion-panel
        (opened)="goToStep(4)"
        [expanded]="currentStep() === 4"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              4. Behandlungen – durchgeführte oder geplante Spitalaufenthalte/Operationen
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div
          (click)="setActive('opsQ')"
          [class.is-active]="isActive('opsQ') || hasValue(form.controls.opsQ)"
          [class.is-invalid]="isInvalid('opsQ')"
          class="seg"
        >
          <button
            (click)="$event.stopPropagation(); setOpsQ(false)"
            [class.is-selected]="form.controls.opsQ.value === false"
            class="seg__btn"
            type="button"
          >
            Nein
          </button>

          <button
            (click)="$event.stopPropagation(); setOpsQ(true)"
            [class.is-selected]="form.controls.opsQ.value === true"
            class="seg__btn"
            type="button"
          >
            Ja
          </button>
        </div>

        @if (isInvalid('opsQ')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (showOpsDetails()) {
          <p class="home__desc">
            Haben Sie sich in den letzten fünf Jahren einer Operation unterzogen, fand ein Spitalaufenthalt statt oder
            haben Sie sich einer (medizinischen oder therapeutischen) Behandlung unterzogen oder beabsichtigen Sie,
            sich einer Konsultation, Behandlung oder Operation zu unterziehen?
          </p>

          <div class="home__sub">
            <h2 class="h2">a) In einem Spital, einer Kureinrichtung oder einer Entzugsklinik</h2>

            <div
              (click)="setActive('opsA')"
              [class.is-active]="isActive('opsA') || hasValue(form.controls.opsA)"
              [class.is-invalid]="isInvalid('opsA')"
              class="seg"
            >
              <button
                (click)="$event.stopPropagation(); setOpsA(false)"
                [class.is-selected]="form.controls.opsA.value === false"
                class="seg__btn"
                type="button"
              >
                Nein
              </button>

              <button
                (click)="$event.stopPropagation(); setOpsA(true)"
                [class.is-selected]="form.controls.opsA.value === true"
                class="seg__btn"
                type="button"
              >
                Ja
              </button>
            </div>

            @if (isInvalid('opsA')) {
              <p class="error">Bitte wählen.</p>
            }
          </div>

          <div class="home__sub">
            <h2 class="h2">b) Bei einem Arzt, Physiotherapeuten oder Chiropraktiker</h2>

            <div
              (click)="setActive('opsB')"
              [class.is-active]="isActive('opsB') || hasValue(form.controls.opsB)"
              [class.is-invalid]="isInvalid('opsB')"
              class="seg"
            >
              <button
                (click)="$event.stopPropagation(); setOpsB(false)"
                [class.is-selected]="form.controls.opsB.value === false"
                class="seg__btn"
                type="button"
              >
                Nein
              </button>

              <button
                (click)="$event.stopPropagation(); setOpsB(true)"
                [class.is-selected]="form.controls.opsB.value === true"
                class="seg__btn"
                type="button"
              >
                Ja
              </button>
            </div>

            @if (isInvalid('opsB')) {
              <p class="error">Bitte wählen.</p>
            }

            @if (form.controls.opsB.value === true) {
              <div class="illness" formArrayName="opsBItems">
                @for (g of opsBItems.controls; track g; let i = $index) {
                  <div [formGroupName]="i" class="illness__card" (click)="$event.stopPropagation()">
                    <div class="illness__head">
                      <div class="illness__title">{{ i + 1 }}) Krankheit erfassen</div>

                      @if (opsBItems.length > 1) {
                        <button
                          type="button"
                          class="illness__remove"
                          (click)="$event.stopPropagation(); removeOpsBItemByRef(g)"
                        >
                          - Entfernen
                        </button>
                      }
                    </div>

                    <p class="illness__hint">
                      Krankheit, Leiden, Unfall, Behandlungsgrund, betroffene Stelle am Körper (links, rechts)
                    </p>

                    <div
                      (click)="setActive(opsBActiveKey(i,'desc'))"
                      [class.is-active]="isOpsBActive(i,'desc') || hasText(illnessCtrl(opsBItems, i,'desc'))"
                      [class.is-invalid]="isInvalidCtrl(illnessCtrl(opsBItems, i,'desc'))"
                      class="box box--textarea"
                    >
                  <textarea
                    (focus)="setActive(opsBActiveKey(i,'desc'))"
                    (input)="autoResize($event)"
                    formControlName="desc"
                    placeholder="Hier eingeben..."
                  ></textarea>

                      <span aria-hidden="true" class="icon-pencil"></span>
                    </div>
                    @if (isInvalidCtrl(illnessCtrl(opsBItems, i, 'desc'))) {
                      <p class="error">Bitte ausfüllen.</p>
                    }

                    <div class="grid-2 dates">
                      <div
                        [class.has-error]="isInvalidCtrl(illnessCtrl(opsBItems, i,'startDate'))"
                        class="field"
                      >
                        <label class="label">Begindatum</label>

                        <div
                          (click)="setActive(opsBActiveKey(i,'start'))"
                          [class.is-active]="isOpsBActive(i,'start') || hasText(illnessCtrl(opsBItems, i,'startDate'))"
                          [class.is-invalid]="isInvalidCtrl(illnessCtrl(opsBItems, i,'startDate'))"
                          class="box"
                        >
                          <input
                            (focus)="setActive(opsBActiveKey(i,'start'))"
                            formControlName="startDate"
                            type="date"
                          />
                          <img alt="" aria-hidden="true" class="calendar-icon" src="/Icon.jpg"/>
                        </div>

                        @if (isInvalidCtrl(illnessCtrl(opsBItems, i, 'startDate'))) {
                          <p class="error">Bitte Datum wählen.</p>
                        }
                      </div>

                      <div
                        [class.has-error]="isInvalidCtrl(illnessCtrl(opsBItems, i,'endDate'))"
                        class="field"
                      >
                        <label class="label">Enddatum</label>

                        <div
                          (click)="setActive(opsBActiveKey(i,'end'))"
                          [class.is-active]="isOpsBActive(i,'end') || hasText(illnessCtrl(opsBItems, i,'endDate'))"
                          [class.is-invalid]="isInvalidCtrl(illnessCtrl(opsBItems, i,'endDate'))"
                          class="box"
                        >
                          <input
                            (focus)="setActive(opsBActiveKey(i,'end'))"
                            formControlName="endDate"
                            type="date"
                          />
                          <img alt="" aria-hidden="true" class="calendar-icon" src="/Icon.jpg"/>
                        </div>

                        @if (isInvalidCtrl(illnessCtrl(opsBItems, i, 'endDate'))) {
                          <p class="error">Bitte Datum wählen.</p>
                        }
                      </div>
                    </div>
                    <div class="field">
                      <label class="label">Operiert?</label>
                      <div
                        (click)="setActive(opsBActiveKey(i,'operated'))"
                        [class.is-active]="isOpsBActive(i,'operated') || hasValue(illnessCtrl(opsBItems, i,'operated'))"
                        [class.is-invalid]="isInvalidCtrl(illnessCtrl(opsBItems, i,'operated'))"
                        class="seg"
                      >
                        <button
                          (click)="$event.stopPropagation(); setOpsBBool(i,'operated',false)"
                          [class.is-selected]="illnessCtrl(opsBItems, i,'operated').value === false"
                          class="seg__btn"
                          type="button"
                        >
                          Nein
                        </button>
                        <button
                          (click)="$event.stopPropagation(); setOpsBBool(i,'operated',true)"
                          [class.is-selected]="illnessCtrl(opsBItems, i,'operated').value === true"
                          class="seg__btn"
                          type="button"
                        >
                          Ja
                        </button>
                      </div>

                      @if (isInvalidCtrl(illnessCtrl(opsBItems, i, 'operated'))) {
                        <p class="error">Bitte wählen.</p>
                      }
                    </div>

                    <div class="field">
                      <label class="label">Behandlung beendet, genesen ohne Folgen</label>
                      <div
                        (click)="setActive(opsBActiveKey(i,'treatmentDone'))"
                        [class.is-active]="isOpsBActive(i,'treatmentDone') || hasValue(illnessCtrl(opsBItems, i,'treatmentDone'))"
                        [class.is-invalid]="isInvalidCtrl(illnessCtrl(opsBItems, i,'treatmentDone'))"
                        class="seg"
                      >
                        <button
                          (click)="$event.stopPropagation(); setOpsBBool(i,'treatmentDone',false)"
                          [class.is-selected]="illnessCtrl(opsBItems, i,'treatmentDone').value === false"
                          class="seg__btn"
                          type="button"
                        >
                          Nein
                        </button>
                        <button
                          (click)="$event.stopPropagation(); setOpsBBool(i,'treatmentDone',true)"
                          [class.is-selected]="illnessCtrl(opsBItems, i,'treatmentDone').value === true"
                          class="seg__btn"
                          type="button"
                        >
                          Ja
                        </button>
                      </div>

                      @if (isInvalidCtrl(illnessCtrl(opsBItems, i, 'treatmentDone'))) {
                        <p class="error">Bitte wählen.</p>
                      }
                    </div>

                    <div class="provider">
                      <p class="provider__title">
                        Name und Adresse des Arztes, Spitals oder anderen Leistungserbringers
                      </p>

                      <div class="provider__grid provider__grid--name">
                        <div class="field">
                          <div
                            (click)="setActive(opsBActiveKey(i,'docFirstName'))"
                            [class.is-active]="isOpsBActive(i,'docFirstName') || hasText(illnessCtrl(opsBItems, i,'docFirstName'))"
                            [class.is-invalid]="isInvalidCtrl(illnessCtrl(opsBItems, i,'docFirstName'))"
                            class="box provider__box"
                          >
                            <input
                              (focus)="setActive(opsBActiveKey(i,'docFirstName'))"
                              formControlName="docFirstName"
                              placeholder="Vorname"
                              type="text"
                            />
                          </div>
                          @if (isInvalidCtrl(illnessCtrl(opsBItems, i, 'docFirstName'))) {
                            <p class="error">Bitte ausfüllen.</p>
                          }
                        </div>

                        <div class="field">
                          <div
                            (click)="setActive(opsBActiveKey(i,'docLastName'))"
                            [class.is-active]="isOpsBActive(i,'docLastName') || hasText(illnessCtrl(opsBItems, i,'docLastName'))"
                            [class.is-invalid]="isInvalidCtrl(illnessCtrl(opsBItems, i,'docLastName'))"
                            class="box provider__box"
                          >
                            <input
                              (focus)="setActive(opsBActiveKey(i,'docLastName'))"
                              formControlName="docLastName"
                              placeholder="Nachname"
                              type="text"
                            />
                          </div>
                          @if (isInvalidCtrl(illnessCtrl(opsBItems, i, 'docLastName'))) {
                            <p class="error">Bitte ausfüllen.</p>
                          }
                        </div>
                      </div>

                      <div class="provider__grid provider__grid--street">
                        <div class="field">
                          <div
                            (click)="setActive(opsBActiveKey(i,'docStreet'))"
                            [class.is-active]="isOpsBActive(i,'docStreet') || hasText(illnessCtrl(opsBItems, i,'docStreet'))"
                            [class.is-invalid]="isInvalidCtrl(illnessCtrl(opsBItems, i,'docStreet'))"
                            class="box provider__box"
                          >
                            <input
                              (focus)="setActive(opsBActiveKey(i,'docStreet'))"
                              formControlName="docStreet"
                              placeholder="Strasse"
                              type="text"
                            />
                          </div>
                          @if (isInvalidCtrl(illnessCtrl(opsBItems, i, 'docStreet'))) {
                            <p class="error">Bitte ausfüllen.</p>
                          }
                        </div>

                        <div class="field">
                          <div
                            (click)="setActive(opsBActiveKey(i,'docNr'))"
                            [class.is-active]="isOpsBActive(i,'docNr') || hasText(illnessCtrl(opsBItems, i,'docNr'))"
                            [class.is-invalid]="isInvalidCtrl(illnessCtrl(opsBItems, i,'docNr'))"
                            class="box provider__box"
                          >
                            <input
                              (focus)="setActive(opsBActiveKey(i,'docNr'))"
                              formControlName="docNr"
                              placeholder="Nr."
                              type="text"
                            />
                          </div>
                          @if (isInvalidCtrl(illnessCtrl(opsBItems, i, 'docNr'))) {
                            <p class="error">Bitte ausfüllen.</p>
                          }
                        </div>
                      </div>

                      <div class="provider__grid provider__grid--zip">
                        <div class="field">
                          <div
                            (click)="setActive(opsBActiveKey(i,'docZipCity'))"
                            [class.is-active]="isOpsBActive(i,'docZipCity') || hasText(illnessCtrl(opsBItems, i,'docZipCity'))"
                            [class.is-invalid]="isInvalidCtrl(illnessCtrl(opsBItems, i,'docZipCity'))"
                            class="box provider__box"
                          >
                            <input
                              (focus)="setActive(opsBActiveKey(i,'docZipCity'))"
                              formControlName="docZipCity"
                              placeholder="PLZ, Ort"
                              type="text"
                            />
                          </div>
                          @if (isInvalidCtrl(illnessCtrl(opsBItems, i, 'docZipCity'))) {
                            <p class="error">Bitte ausfüllen.</p>
                          }
                        </div>
                      </div>
                    </div>
                  </div>
                }
              </div>

              <button
                (click)="addOpsBItem()"
                [attr.aria-disabled]="!canAddOpsBItem()"
                [class.is-disabled]="!canAddOpsBItem()"
                class="btn-add btn-add--bottom"
                type="button"
              >
                + Krankheit erfassen
              </button>
            }
          </div>

          <div class="home__sub">
            <h2 class="h2">c) Bei einem Psychiater, Psychologen oder Psychotherapeuten</h2>

            <div
              (click)="setActive('opsC')"
              [class.is-active]="isActive('opsC') || hasValue(form.controls.opsC)"
              [class.is-invalid]="isInvalid('opsC')"
              class="seg"
            >
              <button
                (click)="$event.stopPropagation(); setOpsC(false)"
                [class.is-selected]="form.controls.opsC.value === false"
                class="seg__btn"
                type="button"
              >
                Nein
              </button>

              <button
                (click)="$event.stopPropagation(); setOpsC(true)"
                [class.is-selected]="form.controls.opsC.value === true"
                class="seg__btn"
                type="button"
              >
                Ja
              </button>
            </div>

            @if (isInvalid('opsC')) {
              <p class="error">Bitte wählen.</p>
            }
          </div>

          <div class="home__sub">
            <h2 class="h2">
              d) Bei einem Naturheilpraktiker, einem nichtmedizinischen Therapeuten,
              einem Therapeuten für Naturheilkunde oder einem Osteopathen
            </h2>

            <div
              (click)="setActive('opsD')"
              [class.is-active]="isActive('opsD') || hasValue(form.controls.opsD)"
              [class.is-invalid]="isInvalid('opsD')"
              class="seg"
            >
              <button
                (click)="$event.stopPropagation(); setOpsD(false)"
                [class.is-selected]="form.controls.opsD.value === false"
                class="seg__btn"
                type="button"
              >
                Nein
              </button>

              <button
                (click)="$event.stopPropagation(); setOpsD(true)"
                [class.is-selected]="form.controls.opsD.value === true"
                class="seg__btn"
                type="button"
              >
                Ja
              </button>
            </div>

            @if (isInvalid('opsD')) {
              <p class="error">Bitte wählen.</p>
            }
          </div>
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 5. Arzt -->
    @if (maxStepReached() >= 5) {
      <mat-expansion-panel
        (opened)="goToStep(5)"
        [expanded]="currentStep() === 5"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              5. Arzt
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <p class="p home__subtitle">Name und Adresse des Arztes, den Sie gewöhnlich aufsuchen:</p>

        <div class="grid-2">
          <div class="field">
            <div
              (click)="setActive('doctorFirstName')"
              [class.is-active]="isActive('doctorFirstName') || hasText(form.controls.doctorFirstName)"
              [class.is-invalid]="isInvalid('doctorFirstName')"
              class="box"
            >
              <input
                (focus)="setActive('doctorFirstName')"
                formControlName="doctorFirstName"
                placeholder="Vorname"
                type="text"
              />
            </div>

            @if (isInvalid('doctorFirstName')) {
              <p class="error">Bitte ausfullen!</p>
            }
          </div>

          <div class="field">
            <div
              (click)="setActive('doctorLastName')"
              [class.is-active]="isActive('doctorLastName') || hasText(form.controls.doctorLastName)"
              [class.is-invalid]="isInvalid('doctorLastName')"
              class="box"
            >
              <input
                (focus)="setActive('doctorLastName')"
                formControlName="doctorLastName"
                placeholder="Nachname"
                type="text"
              />
            </div>

            @if (isInvalid('doctorLastName')) {
              <p class="error">Bitte ausfullen!</p>
            }
          </div>
        </div>

        <div class="provider__grid provider__grid--street">
          <div class="field">
            <div
              (click)="setActive('doctorStreet')"
              [class.is-active]="isActive('doctorStreet') || hasText(form.controls.doctorStreet)"
              [class.is-invalid]="isInvalid('doctorStreet')"
              class="box"
            >
              <input
                (focus)="setActive('doctorStreet')"
                formControlName="doctorStreet"
                placeholder="Strasse"
                type="text"
              />
            </div>

            @if (isInvalid('doctorStreet')) {
              <p class="error">Bitte ausfullen!</p>
            }
          </div>

          <div class="field">
            <div
              (click)="setActive('doctorNumber')"
              [class.is-active]="isActive('doctorNumber') || hasText(form.controls.doctorNumber)"
              [class.is-invalid]="isInvalid('doctorNumber')"
              class="box"
            >
              <input
                (focus)="setActive('doctorNumber')"
                formControlName="doctorNumber"
                placeholder="Nr."
                type="text"
              />
            </div>

            @if (isInvalid('doctorNumber')) {
              <p class="error">Bitte ausfullen!</p>
            }
          </div>
        </div>

        <div class="field">
          <div
            (click)="setActive('doctorCity')"
            [class.is-active]="isActive('doctorCity') || hasText(form.controls.doctorCity)"
            [class.is-invalid]="isInvalid('doctorCity')"
            class="box"
          >
            <input
              (focus)="setActive('doctorCity')"
              formControlName="doctorCity"
              placeholder="PLZ, Ort"
              type="text"
            />
          </div>

          @if (isInvalid('doctorCity')) {
            <p class="error">Bitte ausfullen!</p>
          }
        </div>
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- ===================== 6. BERICHTE UPLOAD ===================== -->
    @if (maxStepReached() >= 6) {
      <mat-expansion-panel
        (opened)="goToStep(6)"
        [expanded]="currentStep() === 6"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              6. Lade bitte deine vorhandenen Berichte wie
              Operationsbericht, Austrittsbericht oder Arztbericht hoch.
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div
          (click)="reportInput.click()"
          (dragleave)="onReportDragLeave($event)"
          (dragover)="onReportDragOver($event)"
          (drop)="onReportDrop($event)"
          (keydown.enter)="reportInput.click()"
          (keydown.space)="$event.preventDefault(); reportInput.click()"
          [class.is-invalid]="isInvalid('reportFile')"
          [class.upload--active]="selectedReportName()"
          [class.upload--dragover]="isReportDragOver()"
          [class.upload--inactive]="!selectedReportName()"
          class="upload"
          role="button"
          tabindex="0"
        >
          <div class="upload__inner">
            <img alt="" class="upload__icon" src="cloud-upload-24px.svg.svg"/>
            <div class="upload__name">
              {{ selectedReportName() || 'Upload' }}
            </div>
          </div>

          <input
            #reportInput
            (change)="onReportPicked($event)"
            accept="application/pdf,.pdf"
            class="upload__input"
            type="file"
          />
        </div>

        @if (isInvalid('reportFile')) {
          <p class="error">Bitte lade eine PDF-Datei hoch.</p>
        }

        <button class="pill-btn" type="button">Dental Fragen</button>
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 7. Zustand des Zahnbetts -->
    @if (maxStepReached() >= 7) {
      <mat-expansion-panel
        (opened)="goToStep(7)"
        [expanded]="currentStep() === 7"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              7. Zustand des Zahnbetts:
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div
          [class.is-invalid]="isInvalid('teethCondition')"
          [class.seg--dental-active]="hasValue(form.controls.teethCondition)"
          class="seg seg--dental seg--triple"
        >
          <button
            (click)="$event.stopPropagation(); setTeethCondition('gut')"
            [class.is-selected]="form.controls.teethCondition.value === 'gut'"
            class="seg__btn"
            type="button"
          >
            Gut
          </button>

          <button
            (click)="$event.stopPropagation(); setTeethCondition('mangelhaft')"
            [class.is-selected]="form.controls.teethCondition.value === 'mangelhaft'"
            class="seg__btn"
            type="button"
          >
            Mangelhaft
          </button>

          <button
            (click)="$event.stopPropagation(); setTeethCondition('schlecht')"
            [class.is-selected]="form.controls.teethCondition.value === 'schlecht'"
            class="seg__btn"
            type="button"
          >
            Schlecht
          </button>
        </div>

        @if (isInvalid('teethCondition')) {
          <p class="error">Bitte wählen.</p>
        }

        @if (form.controls.teethCondition.value === 'mangelhaft' || form.controls.teethCondition.value === 'schlecht') {
          <p class="dental-help">Falls mangelhaft oder schlecht, bitte Stelle präzisieren:</p>

          <div
            (click)="setActive('teethConditionNote')"
            [class.is-active]="isActive('teethConditionNote') || hasText(form.controls.teethConditionNote)"
            [class.is-invalid]="isInvalid('teethConditionNote')"
            class="box box--textarea box--dental-note"
          >
        <textarea
          (focus)="setActive('teethConditionNote')"
          (input)="autoResize($event)"
          class="dental-note__textarea"
          formControlName="teethConditionNote"
          placeholder="Hier eingeben..."
        ></textarea>
          </div>

          @if (isInvalid('teethConditionNote')) {
            <p class="error">Bitte ausfüllen.</p>
          }
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 8. Hygiene -->
    @if (maxStepReached() >= 8) {
      <mat-expansion-panel
        (opened)="goToStep(8)"
        [expanded]="currentStep() === 8"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">8. Hygiene:</h2>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div
          [class.is-invalid]="isInvalid('hygiene')"
          [class.seg--dental-active]="hasValue(form.controls.hygiene)"
          class="seg seg--dental seg--triple"
        >
          <button
            (click)="$event.stopPropagation(); setHygiene('gut')"
            [class.is-selected]="form.controls.hygiene.value === 'gut'"
            class="seg__btn"
            type="button"
          >
            Gut
          </button>

          <button
            (click)="$event.stopPropagation(); setHygiene('mangelhaft')"
            [class.is-selected]="form.controls.hygiene.value === 'mangelhaft'"
            class="seg__btn"
            type="button"
          >
            Mangelhaft
          </button>

          <button
            (click)="$event.stopPropagation(); setHygiene('schlecht')"
            [class.is-selected]="form.controls.hygiene.value === 'schlecht'"
            class="seg__btn"
            type="button"
          >
            Schlecht
          </button>
        </div>

        @if (isInvalid('hygiene')) {
          <p class="error">Bitte wählen.</p>
        }

        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }


    <!-- 9. Okklusion -->
    @if (maxStepReached() >= 9) {
      <mat-expansion-panel
        (opened)="goToStep(9)"
        [expanded]="currentStep() === 9"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              9. Okklusion:
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div [class.seg--dental-active]="hasValue(form.controls.occlusion)" class="seg seg--dental seg--triple">
          <button
            (click)="setOcclusion('klasse1')"
            [class.is-selected]="form.controls.occlusion.value === 'klasse1'"
            class="seg__btn"
            type="button"
          >
            Klasse I
          </button>

          <button
            (click)="setOcclusion('klasse2')"
            [class.is-selected]="form.controls.occlusion.value === 'klasse2'"
            class="seg__btn"
            type="button"
          >
            Klasse II
          </button>

          <button
            (click)="setOcclusion('klasse3')"
            [class.is-selected]="form.controls.occlusion.value === 'klasse3'"
            class="seg__btn"
            type="button"
          >
            Klasse III
          </button>
        </div>

        @if (isInvalid('occlusion')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 10. Zustand der Kronen -->
    @if (maxStepReached() >= 10) {
      <mat-expansion-panel
        (opened)="goToStep(10)"
        [expanded]="currentStep() === 10"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              10. Zustand der Kronen:
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div [class.seg--dental-active]="hasValue(form.controls.crownsCondition)" class="seg seg--dental seg--quad">
          <button
            (click)="setCrownsCondition('keine')"
            [class.is-selected]="form.controls.crownsCondition.value === 'keine'"
            class="seg__btn"
            type="button"
          >
            Keine
          </button>

          <button
            (click)="setCrownsCondition('gut')"
            [class.is-selected]="form.controls.crownsCondition.value === 'gut'"
            class="seg__btn"
            type="button"
          >
            Gut
          </button>

          <button
            (click)="setCrownsCondition('mangelhaft')"
            [class.is-selected]="form.controls.crownsCondition.value === 'mangelhaft'"
            class="seg__btn"
            type="button"
          >
            Mangelhaft
          </button>

          <button
            (click)="setCrownsCondition('schlecht')"
            [class.is-selected]="form.controls.crownsCondition.value === 'schlecht'"
            class="seg__btn"
            type="button"
          >
            Schlecht
          </button>
        </div>

        @if (isInvalid('crownsCondition')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (form.controls.crownsCondition.value === 'mangelhaft') {
          <p class="dental-help">Art und Stelle:</p>

          <div
            (click)="setActive('crownsNote')"
            [class.is-active]="isActive('crownsNote') || hasText(form.controls.crownsNote)"
            [class.is-invalid]="isInvalid('crownsNote')"
            class="box box--textarea box--dental-note"
          >
        <textarea
          (focus)="setActive('crownsNote')"
          (input)="autoResize($event)"
          formControlName="crownsNote"
          placeholder="Hier eingeben..."
        ></textarea>
          </div>

          @if (isInvalid('crownsNote')) {
            <p class="error">Bitte ausfüllen.</p>
          }
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 11. Zustand der Brücken -->
    @if (maxStepReached() >= 11) {
      <mat-expansion-panel
        (opened)="goToStep(11)"
        [expanded]="currentStep() === 11"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              11. Zustand der Brücken:
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div [class.seg--dental-active]="hasValue(form.controls.bridgesCondition)" class="seg seg--dental seg--quad">
          <button
            (click)="setBridgesCondition('keine')"
            [class.is-selected]="form.controls.bridgesCondition.value === 'keine'"
            class="seg__btn"
            type="button"
          >
            Keine
          </button>

          <button
            (click)="setBridgesCondition('gut')"
            [class.is-selected]="form.controls.bridgesCondition.value === 'gut'"
            class="seg__btn"
            type="button"
          >
            Gut
          </button>

          <button
            (click)="setBridgesCondition('mangelhaft')"
            [class.is-selected]="form.controls.bridgesCondition.value === 'mangelhaft'"
            class="seg__btn"
            type="button"
          >
            Mangelhaft
          </button>

          <button
            (click)="setBridgesCondition('schlecht')"
            [class.is-selected]="form.controls.bridgesCondition.value === 'schlecht'"
            class="seg__btn"
            type="button"
          >
            Schlecht
          </button>
        </div>

        @if (isInvalid('bridgesCondition')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (form.controls.bridgesCondition.value === 'mangelhaft') {
          <p class="dental-help">Art und Stelle:</p>

          <div
            (click)="setActive('bridgesNote')"
            [class.is-active]="isActive('bridgesNote') || hasText(form.controls.bridgesNote)"
            [class.is-invalid]="isInvalid('bridgesNote')"
            class="box box--textarea box--dental-note"
          >
        <textarea
          (focus)="setActive('bridgesNote')"
          (input)="autoResize($event)"
          formControlName="bridgesNote"
          placeholder="Hier eingeben..."
        ></textarea>
          </div>

          @if (isInvalid('bridgesNote')) {
            <p class="error">Bitte ausfüllen.</p>
          }
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 12. Zustand der Teilprothesen -->
    @if (maxStepReached() >= 12) {
      <mat-expansion-panel
        (opened)="goToStep(12)"
        [expanded]="currentStep() === 12"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              12. Zustand der Teilprothesen:
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div
          [class.seg--dental-active]="hasValue(form.controls.partialDenturesCondition)"
          class="seg seg--dental seg--quad"
        >
          <button
            (click)="setPartialDenturesCondition('keine')"
            [class.is-selected]="form.controls.partialDenturesCondition.value === 'keine'"
            class="seg__btn"
            type="button"
          >
            Keine
          </button>

          <button
            (click)="setPartialDenturesCondition('gut')"
            [class.is-selected]="form.controls.partialDenturesCondition.value === 'gut'"
            class="seg__btn"
            type="button"
          >
            Gut
          </button>

          <button
            (click)="setPartialDenturesCondition('mangelhaft')"
            [class.is-selected]="form.controls.partialDenturesCondition.value === 'mangelhaft'"
            class="seg__btn"
            type="button"
          >
            Mangelhaft
          </button>

          <button
            (click)="setPartialDenturesCondition('schlecht')"
            [class.is-selected]="form.controls.partialDenturesCondition.value === 'schlecht'"
            class="seg__btn"
            type="button"
          >
            Schlecht
          </button>
        </div>

        @if (isInvalid('partialDenturesCondition')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (form.controls.partialDenturesCondition.value === 'mangelhaft') {
          <p class="dental-help">Art und Stelle:</p>

          <div
            (click)="setActive('partialDenturesNote')"
            [class.is-active]="isActive('partialDenturesNote') || hasText(form.controls.partialDenturesNote)"
            [class.is-invalid]="isInvalid('partialDenturesNote')"
            class="box box--textarea box--dental-note"
          >
        <textarea
          (focus)="setActive('partialDenturesNote')"
          (input)="autoResize($event)"
          formControlName="partialDenturesNote"
          placeholder="Hier eingeben..."
        ></textarea>
          </div>

          @if (isInvalid('partialDenturesNote')) {
            <p class="error">Bitte ausfüllen.</p>
          }
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 13. Dentition -->
    @if (maxStepReached() >= 13) {
      <mat-expansion-panel
        (opened)="goToStep(13)"
        [expanded]="currentStep() === 13"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              13. Dentition: Hat der Versicherte eine Fehl- oder Missbildung oder einen Stellungsfehler der Zähne?
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div
          (click)="setActive('dentition')"
          [class.is-invalid]="isInvalid('dentition')"
          [class.seg--dental-active]="hasValue(form.controls.dentition)"
          class="seg seg--dental seg--binary"
        >
          <button
            (click)="$event.stopPropagation(); setDentition(false)"
            [class.is-selected]="form.controls.dentition.value === false"
            class="seg__btn"
            type="button"
          >
            Nein
          </button>

          <button
            (click)="$event.stopPropagation(); setDentition(true)"
            [class.is-selected]="form.controls.dentition.value === true"
            class="seg__btn"
            type="button"
          >
            Ja
          </button>
        </div>

        @if (isInvalid('dentition')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (form.controls.dentition.value === true) {
          <p class="dental-help">Wenn ja, welche?</p>

          <div
            (click)="setActive('dentitionNote')"
            [class.is-active]="isActive('dentitionNote') || hasText(form.controls.dentitionNote)"
            [class.is-invalid]="isInvalid('dentitionNote')"
            class="box box--textarea box--dental-note"
          >
        <textarea
          (focus)="setActive('dentitionNote')"
          (input)="autoResize($event)"
          formControlName="dentitionNote"
          placeholder="Hier eingeben..."
        ></textarea>
          </div>

          @if (isInvalid('dentitionNote')) {
            <p class="error">Bitte ausfüllen.</p>
          }
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 14. Kiefer -->
    @if (maxStepReached() >= 14) {
      <mat-expansion-panel
        (opened)="goToStep(14)"
        [expanded]="currentStep() === 14"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              14. Kiefer: Hat der Versicherte eine Fehl- oder Missbildung oder einen Stellungsfehler des Kiefers?
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div
          (click)="setActive('jaw')"
          [class.is-invalid]="isInvalid('jaw')"
          [class.seg--dental-active]="hasValue(form.controls.jaw)"
          class="seg seg--dental seg--binary"
        >
          <button
            (click)="$event.stopPropagation(); setJaw(false)"
            [class.is-selected]="form.controls.jaw.value === false"
            class="seg__btn"
            type="button"
          >
            Nein
          </button>

          <button
            (click)="$event.stopPropagation(); setJaw(true)"
            [class.is-selected]="form.controls.jaw.value === true"
            class="seg__btn"
            type="button"
          >
            Ja
          </button>
        </div>

        @if (isInvalid('jaw')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (form.controls.jaw.value === true) {
          <p class="dental-help">Wenn ja, welche?</p>

          <div
            (click)="setActive('jawNote')"
            [class.is-active]="isActive('jawNote') || hasText(form.controls.jawNote)"
            [class.is-invalid]="isInvalid('jawNote')"
            class="box box--textarea box--dental-note"
          >
        <textarea
          (focus)="setActive('jawNote')"
          (input)="autoResize($event)"
          formControlName="jawNote"
          placeholder="Hier eingeben..."
        ></textarea>
          </div>

          @if (isInvalid('jawNote')) {
            <p class="error">Bitte ausfüllen.</p>
          }
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 15. Zukunft -->
    @if (maxStepReached() >= 15) {
      <mat-expansion-panel
        (opened)="goToStep(15)"
        [expanded]="currentStep() === 15"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              15. Leidet der Versicherte an einer Krankheit, die den Zustand der Zähne in Zukunft beeinflussen könnte?
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div
          (click)="setActive('futureTeethDisease')"
          [class.is-invalid]="isInvalid('futureTeethDisease')"
          [class.seg--dental-active]="hasValue(form.controls.futureTeethDisease)"
          class="seg seg--dental seg--binary"
        >
          <button
            (click)="$event.stopPropagation(); setFutureTeethDisease(false)"
            [class.is-selected]="form.controls.futureTeethDisease.value === false"
            class="seg__btn"
            type="button"
          >
            Nein
          </button>

          <button
            (click)="$event.stopPropagation(); setFutureTeethDisease(true)"
            [class.is-selected]="form.controls.futureTeethDisease.value === true"
            class="seg__btn"
            type="button"
          >
            Ja
          </button>
        </div>

        @if (isInvalid('futureTeethDisease')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (form.controls.futureTeethDisease.value === true) {
          <p class="dental-help">Wenn ja, welche?</p>

          <div
            (click)="setActive('futureTeethDiseaseNote')"
            [class.is-active]="isActive('futureTeethDiseaseNote') || hasText(form.controls.futureTeethDiseaseNote)"
            [class.is-invalid]="isInvalid('futureTeethDiseaseNote')"
            class="box box--textarea box--dental-note"
          >
        <textarea
          (focus)="setActive('futureTeethDiseaseNote')"
          (input)="autoResize($event)"
          formControlName="futureTeethDiseaseNote"
          placeholder="Hier eingeben..."
        ></textarea>
          </div>

          @if (isInvalid('futureTeethDiseaseNote')) {
            <p class="error">Bitte ausfüllen.</p>
          }
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 16. Fehlende, nicht ersetzte Zähne -->
    @if (maxStepReached() >= 16) {
      <mat-expansion-panel
        (opened)="goToStep(16)"
        [expanded]="currentStep() === 16"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              16. Fehlende, nicht ersetzte Zähne:
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div
          (click)="setActive('missingTeethQ')"
          [class.is-active]="isActive('missingTeethQ') || form.controls.missingTeethQ.value !== null"
          [class.is-invalid]="isInvalid('missingTeethQ')"
          class="seg"
        >
          <button
            (click)="$event.stopPropagation(); setMissingTeethQ(false)"
            [class.is-selected]="form.controls.missingTeethQ.value === false"
            class="seg__btn"
            type="button"
          >
            Nein
          </button>

          <button
            (click)="$event.stopPropagation(); setMissingTeethQ(true)"
            [class.is-selected]="form.controls.missingTeethQ.value === true"
            class="seg__btn"
            type="button"
          >
            Ja
          </button>
        </div>

        @if (isInvalid('missingTeethQ')) {
          <p class="error">Bitte wählen Sie einen Option.</p>
        }

        @if (form.controls.missingTeethQ.value === true) {
          <div class="teeth">

            <div class="teeth__nums teeth__nums--top">
              @for (t of teethTop; track t) {
                <div [class.is-hot]="isToothSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

            <div class="teethbar">
              @for (t of teethTop; track t) {
                <button
                  (click)="toggleTooth(t)"
                  [class.is-selected]="isToothSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teethbar teethbar--bottom">
              @for (t of teethBottom; track t) {
                <button
                  (click)="toggleTooth(t)"
                  [class.is-selected]="isToothSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teeth__nums teeth__nums--bottom">
              @for (t of teethBottom; track t) {
                <div [class.is-hot]="isToothSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>
            <div class="teethperm">
              <div class="teethperm__nums teethperm__nums--top">
                @for (t of permTop; track t) {
                  <div [class.is-hot]="isPermSelected(t)" class="teethperm__num">{{ t }}</div>
                }
              </div>

              <div class="teethperm__wrap">
                <div class="teethperm__half teethperm__half--left">
                  @for (t of permTop.slice(0, 8); track t) {
                    <button
                      (click)="togglePerm(t)"
                      [class.is-selected]="isPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <div class="teethperm__half teethperm__half--right">
                  @for (t of permTop.slice(8, 16); track t) {
                    <button
                      (click)="togglePerm(t)"
                      [class.is-selected]="isPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <span aria-hidden="true" class="teethperm__mid"></span>
              </div>

              <div class="teethperm__wrap teethperm__wrap--bottom">
                <div class="teethperm__half teethperm__half--left">
                  @for (t of permBottom.slice(0, 8); track t) {
                    <button
                      (click)="togglePerm(t)"
                      [class.is-selected]="isPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <div class="teethperm__half teethperm__half--right">
                  @for (t of permBottom.slice(8, 16); track t) {
                    <button
                      (click)="togglePerm(t)"
                      [class.is-selected]="isPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <span aria-hidden="true" class="teethperm__mid"></span>
              </div>

              <div class="teethperm__nums teethperm__nums--bottom">
                @for (t of permBottom; track t) {
                  <div [class.is-hot]="isPermSelected(t)" class="teethperm__num">{{ t }}</div>
                }
              </div>
            </div>

            <div class="teeth__nums teeth__nums--top">
              @for (t of milkTop; track t) {
                <div [class.is-hot]="isToothSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

            <div class="teethbar">
              @for (t of milkTop; track t) {
                <button
                  (click)="toggleTooth(t)"
                  [class.is-selected]="isToothSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teethbar teethbar--bottom">
              @for (t of milkBottom; track t) {
                <button
                  (click)="toggleTooth(t)"
                  [class.is-selected]="isToothSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teeth__nums teeth__nums--bottom">
              @for (t of milkBottom; track t) {
                <div [class.is-hot]="isToothSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

          </div>
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }


    <!-- 17. Schadhafte Zahnfüllungen -->
    @if (maxStepReached() >= 17) {
      <mat-expansion-panel
        (opened)="goToStep(17)"
        [expanded]="currentStep() === 17"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              17. Schadhafte Zahnfüllungen:
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div
          (click)="setActive('fillingsQ')"
          [class.is-active]="isActive('fillingsQ') || form.controls.fillingsQ.value !== null"
          [class.is-invalid]="isInvalid('fillingsQ')"
          class="seg"
        >
          <button
            (click)="$event.stopPropagation(); setFillingsQ(false)"
            [class.is-selected]="form.controls.fillingsQ.value === false"
            class="seg__btn"
            type="button"
          >
            Nein
          </button>

          <button
            (click)="$event.stopPropagation(); setFillingsQ(true)"
            [class.is-selected]="form.controls.fillingsQ.value === true"
            class="seg__btn"
            type="button"
          >
            Ja
          </button>
        </div>

        @if (isInvalid('fillingsQ')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (form.controls.fillingsQ.value === true) {
          <div class="teeth">

            <div class="teeth__nums teeth__nums--top">
              @for (t of teethTop; track t) {
                <div [class.is-hot]="isFillingSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

            <div class="teethbar">
              @for (t of teethTop; track t) {
                <button
                  (click)="toggleFilling(t)"
                  [class.is-selected]="isFillingSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teethbar teethbar--bottom">
              @for (t of teethBottom; track t) {
                <button
                  (click)="toggleFilling(t)"
                  [class.is-selected]="isFillingSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teeth__nums teeth__nums--bottom">
              @for (t of teethBottom; track t) {
                <div [class.is-hot]="isFillingSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

            <div class="teethperm">
              <div class="teethperm__nums teethperm__nums--top">
                @for (t of permTop; track t) {
                  <div [class.is-hot]="isFillingPermSelected(t)" class="teethperm__num">{{ t }}</div>
                }
              </div>

              <div class="teethperm__wrap">
                <div class="teethperm__half teethperm__half--left">
                  @for (t of permTop.slice(0, 8); track t) {
                    <button
                      (click)="toggleFillingPerm(t)"
                      [class.is-selected]="isFillingPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <div class="teethperm__half teethperm__half--right">
                  @for (t of permTop.slice(8, 16); track t) {
                    <button
                      (click)="toggleFillingPerm(t)"
                      [class.is-selected]="isFillingPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <span aria-hidden="true" class="teethperm__mid"></span>
              </div>

              <div class="teethperm__wrap teethperm__wrap--bottom">
                <div class="teethperm__half teethperm__half--left">
                  @for (t of permBottom.slice(0, 8); track t) {
                    <button
                      (click)="toggleFillingPerm(t)"
                      [class.is-selected]="isFillingPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <div class="teethperm__half teethperm__half--right">
                  @for (t of permBottom.slice(8, 16); track t) {
                    <button
                      (click)="toggleFillingPerm(t)"
                      [class.is-selected]="isFillingPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <span aria-hidden="true" class="teethperm__mid"></span>
              </div>

              <div class="teethperm__nums teethperm__nums--bottom">
                @for (t of permBottom; track t) {
                  <div [class.is-hot]="isFillingPermSelected(t)" class="teethperm__num">{{ t }}</div>
                }
              </div>
            </div>

            <div class="teeth__nums teeth__nums--top">
              @for (t of milkTop; track t) {
                <div [class.is-hot]="isFillingSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

            <div class="teethbar">
              @for (t of milkTop; track t) {
                <button
                  (click)="toggleFilling(t)"
                  [class.is-selected]="isFillingSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teethbar teethbar--bottom">
              @for (t of milkBottom; track t) {
                <button
                  (click)="toggleFilling(t)"
                  [class.is-selected]="isFillingSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teeth__nums teeth__nums--bottom">
              @for (t of milkBottom; track t) {
                <div [class.is-hot]="isFillingSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

          </div>
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 18. Kariöse Zähne -->
    @if (maxStepReached() >= 18) {
      <mat-expansion-panel
        (opened)="goToStep(18)"
        [expanded]="currentStep() === 18"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              18. Kariöse Zähne:
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div
          (click)="setActive('cariesQ')"
          [class.is-active]="isActive('cariesQ') || form.controls.cariesQ.value !== null"
          [class.is-invalid]="isInvalid('cariesQ')"
          class="seg"
        >
          <button
            (click)="$event.stopPropagation(); setCariesQ(false)"
            [class.is-selected]="form.controls.cariesQ.value === false"
            class="seg__btn"
            type="button"
          >
            Nein
          </button>

          <button
            (click)="$event.stopPropagation(); setCariesQ(true)"
            [class.is-selected]="form.controls.cariesQ.value === true"
            class="seg__btn"
            type="button"
          >
            Ja
          </button>
        </div>

        @if (isInvalid('cariesQ')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (form.controls.cariesQ.value === true) {
          <div class="teeth">
            <div class="teeth__nums teeth__nums--top">
              @for (t of teethTop; track t) {
                <div [class.is-hot]="isCariesSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

            <div class="teethbar">
              @for (t of teethTop; track t) {
                <button
                  (click)="toggleCaries(t)"
                  [class.is-selected]="isCariesSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teethbar teethbar--bottom">
              @for (t of teethBottom; track t) {
                <button
                  (click)="toggleCaries(t)"
                  [class.is-selected]="isCariesSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teeth__nums teeth__nums--bottom">
              @for (t of teethBottom; track t) {
                <div [class.is-hot]="isCariesSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

            <div class="teethperm">
              <div class="teethperm__nums teethperm__nums--top">
                @for (t of permTop; track t) {
                  <div [class.is-hot]="isCariesPermSelected(t)" class="teethperm__num">{{ t }}</div>
                }
              </div>

              <div class="teethperm__wrap">
                <div class="teethperm__half teethperm__half--left">
                  @for (t of permTop.slice(0, 8); track t) {
                    <button
                      (click)="toggleCariesPerm(t)"
                      [class.is-selected]="isCariesPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <div class="teethperm__half teethperm__half--right">
                  @for (t of permTop.slice(8, 16); track t) {
                    <button
                      (click)="toggleCariesPerm(t)"
                      [class.is-selected]="isCariesPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <span aria-hidden="true" class="teethperm__mid"></span>
              </div>

              <div class="teethperm__wrap teethperm__wrap--bottom">
                <div class="teethperm__half teethperm__half--left">
                  @for (t of permBottom.slice(0, 8); track t) {
                    <button
                      (click)="toggleCariesPerm(t)"
                      [class.is-selected]="isCariesPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <div class="teethperm__half teethperm__half--right">
                  @for (t of permBottom.slice(8, 16); track t) {
                    <button
                      (click)="toggleCariesPerm(t)"
                      [class.is-selected]="isCariesPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <span aria-hidden="true" class="teethperm__mid"></span>
              </div>

              <div class="teethperm__nums teethperm__nums--bottom">
                @for (t of permBottom; track t) {
                  <div [class.is-hot]="isCariesPermSelected(t)" class="teethperm__num">{{ t }}</div>
                }
              </div>
            </div>

            <div class="teeth__nums teeth__nums--top">
              @for (t of milkTop; track t) {
                <div [class.is-hot]="isCariesSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

            <div class="teethbar">
              @for (t of milkTop; track t) {
                <button
                  (click)="toggleCaries(t)"
                  [class.is-selected]="isCariesSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teethbar teethbar--bottom">
              @for (t of milkBottom; track t) {
                <button
                  (click)="toggleCaries(t)"
                  [class.is-selected]="isCariesSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teeth__nums teeth__nums--bottom">
              @for (t of milkBottom; track t) {
                <div [class.is-hot]="isCariesSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>
          </div>
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 19. Wurzelbehandelte Zähne -->
    @if (maxStepReached() >= 19) {
      <mat-expansion-panel
        (opened)="goToStep(19)"
        [expanded]="currentStep() === 19"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              19. Wurzelbehandelte Zähne:
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div
          (click)="setActive('rootCanalQ')"
          [class.is-active]="isActive('rootCanalQ') || form.controls.rootCanalQ.value !== null"
          [class.is-invalid]="isInvalid('rootCanalQ')"
          class="seg"
        >
          <button
            (click)="$event.stopPropagation(); setRootCanalQ(false)"
            [class.is-selected]="form.controls.rootCanalQ.value === false"
            class="seg__btn"
            type="button"
          >
            Nein
          </button>

          <button
            (click)="$event.stopPropagation(); setRootCanalQ(true)"
            [class.is-selected]="form.controls.rootCanalQ.value === true"
            class="seg__btn"
            type="button"
          >
            Ja
          </button>
        </div>

        @if (isInvalid('rootCanalQ')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (form.controls.rootCanalQ.value === true) {
          <div class="teeth">
            <div class="teeth__nums teeth__nums--top">
              @for (t of teethTop; track t) {
                <div [class.is-hot]="isRootSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

            <div class="teethbar">
              @for (t of teethTop; track t) {
                <button
                  (click)="toggleRoot(t)"
                  [class.is-selected]="isRootSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teethbar teethbar--bottom">
              @for (t of teethBottom; track t) {
                <button
                  (click)="toggleRoot(t)"
                  [class.is-selected]="isRootSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teeth__nums teeth__nums--bottom">
              @for (t of teethBottom; track t) {
                <div [class.is-hot]="isRootSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

            <div class="teethperm">
              <div class="teethperm__nums teethperm__nums--top">
                @for (t of permTop; track t) {
                  <div [class.is-hot]="isRootPermSelected(t)" class="teethperm__num">{{ t }}</div>
                }
              </div>

              <div class="teethperm__wrap">
                <div class="teethperm__half teethperm__half--left">
                  @for (t of permTop.slice(0, 8); track t) {
                    <button
                      (click)="toggleRootPerm(t)"
                      [class.is-selected]="isRootPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <div class="teethperm__half teethperm__half--right">
                  @for (t of permTop.slice(8, 16); track t) {
                    <button
                      (click)="toggleRootPerm(t)"
                      [class.is-selected]="isRootPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <span aria-hidden="true" class="teethperm__mid"></span>
              </div>

              <div class="teethperm__wrap teethperm__wrap--bottom">
                <div class="teethperm__half teethperm__half--left">
                  @for (t of permBottom.slice(0, 8); track t) {
                    <button
                      (click)="toggleRootPerm(t)"
                      [class.is-selected]="isRootPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <div class="teethperm__half teethperm__half--right">
                  @for (t of permBottom.slice(8, 16); track t) {
                    <button
                      (click)="toggleRootPerm(t)"
                      [class.is-selected]="isRootPermSelected(t)"
                      aria-label="Tooth {{ t }}"
                      class="teethperm__cell"
                      type="button"
                    >
                <span aria-hidden="true" class="teethperm__badge">
                  <svg viewBox="0 0 24 24">
                    <path
                      d="M20 6L9 17l-5-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="3"
                    />
                  </svg>
                </span>
                    </button>
                  }
                </div>

                <span aria-hidden="true" class="teethperm__mid"></span>
              </div>

              <div class="teethperm__nums teethperm__nums--bottom">
                @for (t of permBottom; track t) {
                  <div [class.is-hot]="isRootPermSelected(t)" class="teethperm__num">{{ t }}</div>
                }
              </div>
            </div>

            <div class="teeth__nums teeth__nums--top">
              @for (t of milkTop; track t) {
                <div [class.is-hot]="isRootSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>

            <div class="teethbar">
              @for (t of milkTop; track t) {
                <button
                  (click)="toggleRoot(t)"
                  [class.is-selected]="isRootSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>


            <div class="teethbar teethbar--bottom">
              @for (t of milkBottom; track t) {
                <button
                  (click)="toggleRoot(t)"
                  [class.is-selected]="isRootSelected(t)"
                  aria-label="Tooth {{ t }}"
                  class="toothcell"
                  type="button"
                >
            <span aria-hidden="true" class="toothcell__badge">
              <svg viewBox="0 0 24 24">
                <path
                  d="M20 6L9 17l-5-5"
                  fill="none"
                  stroke="currentColor"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="3"
                />
              </svg>
            </span>
                </button>
              }
            </div>

            <div class="teeth__nums teeth__nums--bottom">
              @for (t of milkBottom; track t) {
                <div [class.is-hot]="isRootSelected(t)" class="teeth__num">{{ t }}</div>
              }
            </div>
          </div>
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!--20-->
    @if (maxStepReached() >= 20) {
      <mat-expansion-panel
        (opened)="goToStep(20)"
        [expanded]="currentStep() === 20"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              20. Ist eine Behandlung bei einem Zahnarzt/
              Kieferorthopäden im Gang oder geplant?
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div
          (click)="setActive('dentalTreatQ')"
          [class.is-active]="isActive('dentalTreatQ') || form.controls.dentalTreatQ.value !== null"
          [class.is-invalid]="isInvalid('dentalTreatQ')"
          class="seg"
        >
          <button
            (click)="$event.stopPropagation(); setDentalTreatQ(false)"
            [class.is-selected]="form.controls.dentalTreatQ.value === false"
            class="seg__btn"
            type="button"
          >
            Nein
          </button>

          <button
            (click)="$event.stopPropagation(); setDentalTreatQ(true)"
            [class.is-selected]="form.controls.dentalTreatQ.value === true"
            class="seg__btn"
            type="button"
          >
            Ja
          </button>
        </div>

        @if (isInvalid('dentalTreatQ')) {
          <p class="error">Bitte wählen Sie eine Option.</p>
        }

        @if (form.controls.dentalTreatQ.value === true) {
          <p class="p home__subtitle">Wenn ja, welche?</p>

          <div
            (focusin)="setActive('dentalTreatWhich')"
            (focusout)="setActive(null)"
            [class.is-active]="isActive('dentalTreatWhich') || hasText(form.controls.dentalTreatWhich)"
            [class.is-invalid]="isInvalid('dentalTreatWhich')"
            class="box box--textarea"
          >
      <textarea
        (input)="autoResize($event)"
        formControlName="dentalTreatWhich"
        placeholder="Hier eingeben..."
      ></textarea>
          </div>

          @if (isInvalid('dentalTreatWhich')) {
            <p class="error">Bitte ausfüllen.</p>
          }
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }


    <!-- 21. Datum der letzten Radiographie -->
    @if (maxStepReached() >= 21) {
      <mat-expansion-panel
        (opened)="goToStep(21)"
        [expanded]="currentStep() === 21"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              21. Datum der letzten Radiographie:
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div
          (click)="setActive('lastRadiographyDate'); openDatePicker(radioDate)"
          [class.is-active]="isActive('lastRadiographyDate') || hasText(form.controls.lastRadiographyDate)"
          [class.is-invalid]="isInvalid('lastRadiographyDate')"
          class="datebox"
        >
          <input
            #radioDate
            (focus)="setActive('lastRadiographyDate')"
            class="datebox__input"
            formControlName="lastRadiographyDate"
            type="date"
          />

          <img
            (click)="$event.stopPropagation(); setActive('lastRadiographyDate'); openDatePicker(radioDate)"
            alt=""
            aria-hidden="true"
            class="calendar-icon"
            src="/Icon.jpg"
          />
        </div>

        @if (isInvalid('lastRadiographyDate')) {
          <p class="error">Bitte wählen Sie ein Datum.</p>
        }
        <div class="nav">
          <button (click)="onNext()" class="btn-next" type="button">Next</button>
        </div>
      </mat-expansion-panel>
    }

    <!-- 22. Bemerkungen -->
    @if (maxStepReached() >= 22) {
      <mat-expansion-panel
        (opened)="goToStep(22)"
        [expanded]="currentStep() === 22"
        hideToggle
      >
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h2 class="h2">
              22. Bemerkungen:
            </h2>
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div
          [class.is-active]="isActive('remarks') || form.controls.remarks.touched"
          [class.is-invalid]="isInvalid('remarks')"
          class="box box--textarea"
        >
    <textarea
      (focus)="setActive('remarks')"
      (input)="autoResize($event)"
      formControlName="remarks"
      placeholder="Hier eingeben..."
    ></textarea>
        </div>

        @if (isInvalid('remarks')) {
          <p class="error">Bitte ausfüllen.</p>
        }
      </mat-expansion-panel>
    }
  </mat-accordion>



  @if (isFinished()) {
    <div (click)="isFinished.set(false)" class="finish-overlay">
      <div (click)="$event.stopPropagation()" class="finish-card">
        <h2 class="h2">Danke! 🎉</h2>
        <p class="p">Der Fragebogen wurde erfolgreich ausgefüllt.</p>
        <button (click)="isFinished.set(false)" class="finish-btn" type="button">
          OK
        </button>
      </div>
    </div>
  }
</form>
